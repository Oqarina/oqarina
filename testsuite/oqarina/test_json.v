(***
 * Oqarina
 * Copyright 2021 Carnegie Mellon University.
 *
 * NO WARRANTY. THIS CARNEGIE MELLON UNIVERSITY AND SOFTWARE ENGINEERING
 * INSTITUTE MATERIAL IS FURNISHED ON AN "AS-IS" BASIS. CARNEGIE MELLON
 * UNIVERSITY MAKES NO WARRANTIES OF ANY KIND, EITHER EXPRESSED OR
 * IMPLIED, AS TO ANY MATTER INCLUDING, BUT NOT LIMITED TO, WARRANTY OF
 * FITNESS FOR PURPOSE OR MERCHANTABILITY, EXCLUSIVITY, OR RESULTS
 * OBTAINED FROM USE OF THE MATERIAL. CARNEGIE MELLON UNIVERSITY DOES NOT
 * MAKE ANY WARRANTY OF ANY KIND WITH RESPECT TO FREEDOM FROM PATENT,
 * TRADEMARK, OR COPYRIGHT INFRINGEMENT.
 *
 * Released under a BSD (SEI)-style license, please see license.txt or
 * contact permission@sei.cmu.edu for full terms.
 *
 * [DISTRIBUTION STATEMENT A] This material has been approved for public
 * release and unlimited distribution.  Please see Copyright notice for
 * non-US Government use and distribution.
 *
 * This Software includes and/or makes use of the following Third-Party
 * Software subject to its own license:
 *
 * 1. Coq theorem prover (https://github.com/coq/coq/blob/master/LICENSE)
 * Copyright 2021 INRIA.
 *
 * 2. Coq JSON (https://github.com/liyishuai/coq-json/blob/comrade/LICENSE)
 * Copyright 2021 Yishuai Li.
 *
 * DM21-0762
***)

From Coq Require Import
    String.

(** Oqarina library *)
From Oqarina Require Import
    core.all
    AADL.json_frontend.json_frontend
    AADL.Kernel.all
    AADL.instance.all.

(** * Tests *)

(** These examples have been generated using Ocarina https://github.com/openaadl/ocarina. They test the conversion from JSON to AADL, and the capability to prove automatically that the resulting model is well-formed. *)

(** ** Testing properties

This example tests the correct parsing of several property types.

*)

Definition test_properties_JSON : string := "{""aadl_xml"": {""components"": {""component"": {""category"": ""system"", ""features"": {}, ""subcomponents"": {""component"": {""category"": ""device"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""subcomp_subdevice"", ""properties"": {}, ""classifier"": ""subdevice.impl""}}, ""identifier"": ""main.impl"", ""properties"": {""property"": [{""name"": ""Test_Properties::a_record_property"", ""property_value"": {""record"": {""record_field"": [{""integer"": {""value"": ""10""}, ""name"": ""an_integer_field""}, {""name"": ""a_string_field"", ""string"": {""value"": ""test string""}}, {""real_range"": {""value_low"": ""5.0"", ""value_high"": ""10.0""}, ""name"": ""a_real_range_field""}]}}}, {""name"": ""Test_Properties::an_enumeration_property"", ""property_value"": {""enumeration"": {""value"": ""enum2""}}}, {""name"": ""Test_Properties::a_classifier_property"", ""property_value"": {""classifier"": {""value"": ""subdevice""}}}, {""name"": ""Test_Properties::a_reference_property"", ""property_value"": {""reference"": {""value"": ""subcomp_subdevice""}}}, {""name"": ""Test_Properties::a_list_of_list_property"", ""property_value"": {""list"": {""list"": [{""integer"": [{""value"": ""1""}, {""value"": ""2""}]}, {""integer"": [{""value"": ""3""}, {""value"": ""4""}]}]}}}, {""name"": ""Test_Properties::a_boolean_property"", ""property_value"": {""boolean"": {""value"": ""true""}}}, {""name"": ""Test_Properties::a_string_property"", ""property_value"": {""string"": {""value"": ""test string""}}}, {""name"": ""Test_Properties::a_real_range_property"", ""property_value"": {""real_range"": {""value_low"": ""5.0"", ""value_high"": ""10.0""}}}, {""name"": ""Test_Properties::a_real_unit_property"", ""property_value"": {""real_unit"": {""unit"": ""ns"", ""value"": ""10.0""}}}, {""name"": ""Test_Properties::a_negative_real_property"", ""property_value"": {""real"": {""value"": ""-10.0""}}}, {""name"": ""Test_Properties::a_real_property"", ""property_value"": {""real"": {""value"": ""10.0""}}}, {""name"": ""Test_Properties::an_integer_range_property"", ""property_value"": {""integer_range"": {""value_low"": ""5"", ""value_high"": ""10""}}}, {""name"": ""Test_Properties::an_integer_unit_property"", ""property_value"": {""integer_unit"": {""unit"": ""ms"", ""value"": ""10""}}}, {""name"": ""Test_Properties::a_negative_integer_property"", ""property_value"": {""integer"": {""value"": ""-10""}}}, {""name"": ""Test_Properties::an_integer_property"", ""property_value"": {""integer"": {""value"": ""10""}}}]}, ""classifier"": ""main.impl""}}, ""root_system"": ""main.impl""}}".

Definition test_properties_AADL := Map_JSON_String_To_Component test_properties_JSON.

(** Note: this example cannot be well-formed: it relies on property definitions that are not standard, and not encoded in Coq. *)

(** ** Car example, from https://github.com/OpenAADL/AADLib/tree/master/examples/car *)

Definition car : string := "{""aadl_xml"": {""components"": {""component"": {""category"": ""system"", ""features"": {}, ""subcomponents"": {""component"": [{""category"": ""process"", ""features"": {""feature"": [{""direction"": {""kind"": ""out""}, ""identifier"": ""M1_Out"", ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""M1"", ""properties"": {}, ""classifier"": ""M1""}}}, {""direction"": {""kind"": ""in""}, ""identifier"": ""M2_In"", ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""M2"", ""properties"": {}, ""classifier"": ""M2""}}}]}, ""subcomponents"": {}, ""identifier"": ""Process_A"", ""properties"": {""property"": {""name"": ""Actual_Processor_Binding"", ""property_value"": {""list"": {""reference"": {""value"": ""CPU_A""}}}}}, ""classifier"": ""PA""}, {""category"": ""processor"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""CPU_A"", ""properties"": {}, ""classifier"": ""CPU.A""}, {""category"": ""process"", ""features"": {""feature"": [{""direction"": {""kind"": ""in""}, ""identifier"": ""M1_In"", ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""M1"", ""properties"": {}, ""classifier"": ""M1""}}}, {""direction"": {""kind"": ""out""}, ""identifier"": ""M2_Out"", ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""M2"", ""properties"": {}, ""classifier"": ""M2""}}}, {""direction"": {""kind"": ""out""}, ""identifier"": ""M3_Out"", ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""M3"", ""properties"": {}, ""classifier"": ""M3""}}}]}, ""subcomponents"": {}, ""identifier"": ""Process_B"", ""properties"": {""property"": {""name"": ""Actual_Processor_Binding"", ""property_value"": {""list"": {""reference"": {""value"": ""CPU_B""}}}}}, ""classifier"": ""PB""}, {""category"": ""processor"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""CPU_B"", ""properties"": {}, ""classifier"": ""CPU.B""}, {""category"": ""process"", ""features"": {""feature"": {""direction"": {""kind"": ""in""}, ""identifier"": ""M3_In"", ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""M3"", ""properties"": {}, ""classifier"": ""M3""}}}}, ""subcomponents"": {}, ""identifier"": ""Process_C"", ""properties"": {""property"": {""name"": ""Actual_Processor_Binding"", ""property_value"": {""list"": {""reference"": {""value"": ""CPU_C""}}}}}, ""classifier"": ""PC""}, {""category"": ""processor"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""CPU_C"", ""properties"": {""property"": {""name"": ""Scheduling_Protocol"", ""property_value"": {""list"": {""enumeration"": {""value"": ""POSIX_1003_HIGHEST_PRIORITY_FIRST_PROTOCOL""}}}}}, ""classifier"": ""CPU.C""}, {""category"": ""bus"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""CAN"", ""properties"": {""property"": {""name"": ""Bus_Properties::Available_Bandwidth"", ""property_value"": {""list"": {""number"": [{""unit"": ""KBytesps"", ""value"": ""20""}, {""unit"": ""KBytesps"", ""value"": ""100""}, {""unit"": ""KBytesps"", ""value"": ""500""}, {""unit"": ""MBytesps"", ""value"": ""1""}]}}}}, ""classifier"": ""CAN""}]}, ""connections"": {""connection"": [{""src"": {""component"": ""Process_A"", ""feature"": ""m1_out""}, ""dst"": {""component"": ""Process_B"", ""feature"": ""m1_in""}, ""type"": ""port_connection"", ""name"": ""C1"", ""properties"": {""property"": {""name"": ""Actual_Connection_Binding"", ""property_value"": {""list"": {""reference"": {""value"": ""CAN""}}}}}}, {""src"": {""component"": ""Process_B"", ""feature"": ""m2_out""}, ""dst"": {""component"": ""Process_A"", ""feature"": ""m2_in""}, ""type"": ""port_connection"", ""name"": ""C2"", ""properties"": {""property"": {""name"": ""Actual_Connection_Binding"", ""property_value"": {""list"": {""reference"": {""value"": ""CAN""}}}}}}, {""src"": {""component"": ""Process_B"", ""feature"": ""m3_out""}, ""dst"": {""component"": ""Process_C"", ""feature"": ""m3_in""}, ""type"": ""port_connection"", ""name"": ""C3"", ""properties"": {""property"": {""name"": ""Actual_Connection_Binding"", ""property_value"": {""list"": {""reference"": {""value"": ""CAN""}}}}}}]}, ""identifier"": ""Car.impl"", ""properties"": {}, ""classifier"": ""Car.impl""}}, ""root_system"": ""Car.impl""}}".

Definition car_AADL := Map_JSON_String_To_Component car.
Compute car_AADL.


Example car_2 : string :=
"{""aadl_xml"": {""root_system"": ""Car_impl"", ""components"": {""component"": {""category"": ""system"", ""identifier"": ""car_impl"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""Car.impl""}, ""features"": {}, ""subcomponents"": {""component"": [{""category"": ""process"", ""identifier"": ""Process_A"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""PA.A""}, ""features"": {""feature"": [{""identifier"": ""M1_Out"", ""direction"": {""kind"": ""out""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m1"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M1""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}, {""identifier"": ""M2_In"", ""direction"": {""kind"": ""in""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m2"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M2""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}]}, ""subcomponents"": {""component"": [{""category"": ""thread"", ""identifier"": ""T1"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""T1""}, ""features"": {""feature"": {""identifier"": ""M1_Out"", ""direction"": {""kind"": ""out""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m1"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M1""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}}, ""subcomponents"": {}, ""properties"": {""property"": [{""name"": ""Period"", ""property_value"": {""integer_unit"": {""value"": ""100"", ""unit"": ""ms""}}}, {""name"": ""Deadline"", ""property_value"": {""integer_unit"": {""value"": ""200"", ""unit"": ""ms""}}}, {""name"": ""Compute_Execution_Time"", ""property_value"": {""integer_range_unit"": {""value_low"": ""52"", ""value_high"": ""52"", ""unit_low"": ""ms"", ""unit_high"": ""ms""}}}, {""name"": ""Dispatch_Protocol"", ""property_value"": {""enumeration"": {""value"": ""Periodic""}}}]}}, {""category"": ""thread"", ""identifier"": ""T2"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""T2""}, ""features"": {""feature"": {""identifier"": ""M2_In"", ""direction"": {""kind"": ""in""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m2"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M2""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}}, ""subcomponents"": {}, ""properties"": {""property"": [{""name"": ""Period"", ""property_value"": {""integer_unit"": {""value"": ""160"", ""unit"": ""ms""}}}, {""name"": ""Deadline"", ""property_value"": {""integer_unit"": {""value"": ""280"", ""unit"": ""ms""}}}, {""name"": ""Compute_Execution_Time"", ""property_value"": {""integer_range_unit"": {""value_low"": ""52"", ""value_high"": ""52"", ""unit_low"": ""ms"", ""unit_high"": ""ms""}}}, {""name"": ""Dispatch_Protocol"", ""property_value"": {""enumeration"": {""value"": ""Periodic""}}}]}}]}, ""properties"": {}, ""connections"": {""connection"": [{""name"": ""C1"", ""type"": ""port_connection"", ""src"": {""component"": ""T1"", ""feature"": ""m1_out""}, ""dst"": {""feature"": ""M1_Out""}, ""properties"": {}}, {""name"": ""C2"", ""type"": ""port_connection"", ""src"": {""feature"": ""M2_In""}, ""dst"": {""component"": ""T2"", ""feature"": ""m2_in""}, ""properties"": {}}]}}, {""category"": ""processor"", ""identifier"": ""CPU_A"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""CPU.A""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {""property"": {""name"": ""Scheduling_Protocol"", ""property_value"": {""list"": {""enumeration"": {""value"": ""POSIX_1003_HIGHEST_PRIORITY_FIRST_PROTOCOL""}}}}}}, {""category"": ""process"", ""identifier"": ""Process_B"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""PB.B""}, ""features"": {""feature"": [{""identifier"": ""M1_In"", ""direction"": {""kind"": ""in""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m1"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M1""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}, {""identifier"": ""M2_Out"", ""direction"": {""kind"": ""out""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m2"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M2""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}, {""identifier"": ""M3_Out"", ""direction"": {""kind"": ""out""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m3"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M3""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}]}, ""subcomponents"": {""component"": [{""category"": ""thread"", ""identifier"": ""T3"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""T""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {""property"": [{""name"": ""Period"", ""property_value"": {""integer_unit"": {""value"": ""40"", ""unit"": ""ms""}}}, {""name"": ""Deadline"", ""property_value"": {""integer_unit"": {""value"": ""60"", ""unit"": ""ms""}}}, {""name"": ""Compute_Execution_Time"", ""property_value"": {""integer_range_unit"": {""value_low"": ""10"", ""value_high"": ""10"", ""unit_low"": ""ms"", ""unit_high"": ""ms""}}}, {""name"": ""Dispatch_Protocol"", ""property_value"": {""enumeration"": {""value"": ""Periodic""}}}]}}, {""category"": ""thread"", ""identifier"": ""T4"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""T""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {""property"": [{""name"": ""Period"", ""property_value"": {""integer_unit"": {""value"": ""60"", ""unit"": ""ms""}}}, {""name"": ""Deadline"", ""property_value"": {""integer_unit"": {""value"": ""85"", ""unit"": ""ms""}}}, {""name"": ""Compute_Execution_Time"", ""property_value"": {""integer_range_unit"": {""value_low"": ""20"", ""value_high"": ""20"", ""unit_low"": ""ms"", ""unit_high"": ""ms""}}}, {""name"": ""Dispatch_Protocol"", ""property_value"": {""enumeration"": {""value"": ""Periodic""}}}]}}, {""category"": ""thread"", ""identifier"": ""T5"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""T5""}, ""features"": {""feature"": {""identifier"": ""M2_Out"", ""direction"": {""kind"": ""out""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m2"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M2""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}}, ""subcomponents"": {}, ""properties"": {""property"": [{""name"": ""Period"", ""property_value"": {""integer_unit"": {""value"": ""160"", ""unit"": ""ms""}}}, {""name"": ""Deadline"", ""property_value"": {""integer_unit"": {""value"": ""150"", ""unit"": ""ms""}}}, {""name"": ""Compute_Execution_Time"", ""property_value"": {""integer_range_unit"": {""value_low"": ""52"", ""value_high"": ""52"", ""unit_low"": ""ms"", ""unit_high"": ""ms""}}}, {""name"": ""Dispatch_Protocol"", ""property_value"": {""enumeration"": {""value"": ""Periodic""}}}]}}, {""category"": ""thread"", ""identifier"": ""T6"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""T6""}, ""features"": {""feature"": [{""identifier"": ""M1_In"", ""direction"": {""kind"": ""in""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m1"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M1""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}, {""identifier"": ""M3_Out"", ""direction"": {""kind"": ""out""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m3"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M3""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}]}, ""subcomponents"": {}, ""properties"": {""property"": [{""name"": ""Period"", ""property_value"": {""integer_unit"": {""value"": ""100"", ""unit"": ""ms""}}}, {""name"": ""Deadline"", ""property_value"": {""integer_unit"": {""value"": ""220"", ""unit"": ""ms""}}}, {""name"": ""Compute_Execution_Time"", ""property_value"": {""integer_range_unit"": {""value_low"": ""52"", ""value_high"": ""52"", ""unit_low"": ""ms"", ""unit_high"": ""ms""}}}, {""name"": ""Dispatch_Protocol"", ""property_value"": {""enumeration"": {""value"": ""Periodic""}}}]}}]}, ""properties"": {}, ""connections"": {""connection"": [{""name"": ""C1"", ""type"": ""port_connection"", ""src"": {""feature"": ""M1_In""}, ""dst"": {""component"": ""T6"", ""feature"": ""m1_in""}, ""properties"": {}}, {""name"": ""C2"", ""type"": ""port_connection"", ""src"": {""component"": ""T5"", ""feature"": ""m2_out""}, ""dst"": {""feature"": ""M2_Out""}, ""properties"": {}}, {""name"": ""C3"", ""type"": ""port_connection"", ""src"": {""component"": ""T6"", ""feature"": ""m3_out""}, ""dst"": {""feature"": ""M3_Out""}, ""properties"": {}}]}}, {""category"": ""processor"", ""identifier"": ""CPU_B"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""CPU.B""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}, {""category"": ""process"", ""identifier"": ""Process_C"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""PC.C""}, ""features"": {""feature"": {""identifier"": ""M3_In"", ""direction"": {""kind"": ""in""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m3"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M3""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}}, ""subcomponents"": {""component"": [{""category"": ""thread"", ""identifier"": ""T7"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""T""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {""property"": [{""name"": ""Period"", ""property_value"": {""integer_unit"": {""value"": ""60"", ""unit"": ""ms""}}}, {""name"": ""Deadline"", ""property_value"": {""integer_unit"": {""value"": ""60"", ""unit"": ""ms""}}}, {""name"": ""Compute_Execution_Time"", ""property_value"": {""integer_range_unit"": {""value_low"": ""28"", ""value_high"": ""28"", ""unit_low"": ""ms"", ""unit_high"": ""ms""}}}, {""name"": ""Dispatch_Protocol"", ""property_value"": {""enumeration"": {""value"": ""Periodic""}}}]}}, {""category"": ""thread"", ""identifier"": ""T8"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""T8""}, ""features"": {""feature"": {""identifier"": ""M4_In"", ""direction"": {""kind"": ""in""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m4"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M4""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}}, ""subcomponents"": {}, ""properties"": {""property"": [{""name"": ""Period"", ""property_value"": {""integer_unit"": {""value"": ""100"", ""unit"": ""ms""}}}, {""name"": ""Deadline"", ""property_value"": {""integer_unit"": {""value"": ""320"", ""unit"": ""ms""}}}, {""name"": ""Compute_Execution_Time"", ""property_value"": {""integer_range_unit"": {""value_low"": ""25"", ""value_high"": ""25"", ""unit_low"": ""ms"", ""unit_high"": ""ms""}}}, {""name"": ""Dispatch_Protocol"", ""property_value"": {""enumeration"": {""value"": ""Periodic""}}}]}}, {""category"": ""thread"", ""identifier"": ""T9"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""T9""}, ""features"": {""feature"": [{""identifier"": ""M3_In"", ""direction"": {""kind"": ""in""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m3"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M3""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}, {""identifier"": ""M4_Out"", ""direction"": {""kind"": ""out""}, ""type"": {""kind"": ""event_data""}, ""corresponding_instance"": {""component"": {""category"": ""data"", ""identifier"": ""m4"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""M4""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}}}]}, ""subcomponents"": {}, ""properties"": {""property"": [{""name"": ""Period"", ""property_value"": {""integer_unit"": {""value"": ""100"", ""unit"": ""ms""}}}, {""name"": ""Deadline"", ""property_value"": {""integer_unit"": {""value"": ""250"", ""unit"": ""ms""}}}, {""name"": ""Compute_Execution_Time"", ""property_value"": {""integer_range_unit"": {""value_low"": ""14"", ""value_high"": ""14"", ""unit_low"": ""ms"", ""unit_high"": ""ms""}}}, {""name"": ""Dispatch_Protocol"", ""property_value"": {""enumeration"": {""value"": ""Periodic""}}}]}}]}, ""properties"": {}, ""connections"": {""connection"": [{""name"": ""C1"", ""type"": ""port_connection"", ""src"": {""feature"": ""M3_In""}, ""dst"": {""component"": ""T9"", ""feature"": ""m3_in""}, ""properties"": {}}, {""name"": ""C2"", ""type"": ""port_connection"", ""src"": {""component"": ""T9"", ""feature"": ""m4_out""}, ""dst"": {""component"": ""T8"", ""feature"": ""m4_in""}, ""properties"": {}}]}}, {""category"": ""processor"", ""identifier"": ""CPU_C"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""CPU.C""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {""property"": {""name"": ""Scheduling_Protocol"", ""property_value"": {""list"": {""enumeration"": {""value"": ""POSIX_1003_HIGHEST_PRIORITY_FIRST_PROTOCOL""}}}}}}, {""category"": ""bus"", ""identifier"": ""CAN"", ""classifier"": {""namespace"": ""Car"", ""$t"": ""CAN""}, ""features"": {}, ""subcomponents"": {}, ""properties"": {}}]}, ""properties"": {}, ""connections"": {""connection"": [{""name"": ""C1"", ""type"": ""port_connection"", ""src"": {""component"": ""Process_A"", ""feature"": ""m1_out""}, ""dst"": {""component"": ""Process_B"", ""feature"": ""m1_in""}, ""properties"": {}}, {""name"": ""C2"", ""type"": ""port_connection"", ""src"": {""component"": ""Process_B"", ""feature"": ""m2_out""}, ""dst"": {""component"": ""Process_A"", ""feature"": ""m2_in""}, ""properties"": {}}, {""name"": ""C3"", ""type"": ""port_connection"", ""src"": {""component"": ""Process_B"", ""feature"": ""m3_out""}, ""dst"": {""component"": ""Process_C"", ""feature"": ""m3_in""}, ""properties"": {}}]}}}}}".

Definition p := Get_Instance (Map_JSON_String_To_Component car_2).
Compute p.
Lemma p_OK : Well_Formed_Component_Instance p.
Proof.
  prove_Well_Formed_Component_Instance.
Qed.


(** ** RMA example from https://github.com/OpenAADL/AADLib/tree/master/examples/rma *)

Definition rma_test_JSON : string := "
{""aadl_xml"": {""components"": {""component"": {""category"": ""system"", ""features"": {}, ""subcomponents"": {""component"": [{""category"": ""process"", ""features"": {}, ""subcomponents"": {""component"": [{""category"": ""thread"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""Task1"", ""properties"": {""property"": [{""name"": ""Deadline"", ""property_value"": {""integer_unit"": {""unit"": ""ms"", ""value"": 1000}}}, {""name"": ""Compute_Execution_Time"", ""property_value"": {""integer_range_unit"": {""value_low"": 0, ""value_high"": 3, ""unit_high"": ""ms"", ""unit_low"": ""ms""}}}, {""name"": ""Period"", ""property_value"": {""integer_unit"": {""unit"": ""ms"", ""value"": 1000}}}, {""name"": ""Priority"", ""property_value"": {""integer"": {""value"": 1}}}, {""name"": ""Dispatch_Protocol"", ""property_value"": {""enumeration"": {""value"": ""Periodic""}}}]}, ""classifier"": {""$t"": ""Task.impl_1"", ""namespace"": ""RMAAadl""}}, {""category"": ""thread"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""Task2"", ""properties"": {""property"": [{""name"": ""Deadline"", ""property_value"": {""integer_unit"": {""unit"": ""ms"", ""value"": 500}}}, {""name"": ""Compute_Execution_Time"", ""property_value"": {""integer_range_unit"": {""value_low"": 0, ""value_high"": 5, ""unit_high"": ""ms"", ""unit_low"": ""ms""}}}, {""name"": ""Period"", ""property_value"": {""integer_unit"": {""unit"": ""ms"", ""value"": 500}}}, {""name"": ""Priority"", ""property_value"": {""integer"": {""value"": 2}}}, {""name"": ""Dispatch_Protocol"", ""property_value"": {""enumeration"": {""value"": ""Periodic""}}}]}, ""classifier"": {""$t"": ""Task.impl_2"", ""namespace"": ""RMAAadl""}}]}, ""identifier"": ""node_a"", ""properties"": {""property"": {""name"": ""Actual_Processor_Binding"", ""property_value"": {""list"": {""reference"": {""value"": ""cpu""}}}}}, ""classifier"": {""$t"": ""node_a.impl"", ""namespace"": ""RMAAadl""}}, {""category"": ""processor"", ""features"": {}, ""subcomponents"": {}, ""identifier"": ""cpu"", ""properties"": {}, ""classifier"": {""$t"": ""cpu.impl"", ""namespace"": ""RMAAadl""}}]}, ""identifier"": ""rma_impl"", ""properties"": {}, ""classifier"": {""$t"": ""rma.impl"", ""namespace"": ""RMAAadl""}}}, ""root_system"": ""rma_impl""}}".

Definition rma_test_AADL := Get_Instance (Map_JSON_String_To_Component rma_test_JSON).

Lemma rma_test_AADL_OK : Well_Formed_Component_Instance rma_test_AADL.
Proof.
  prove_Well_Formed_Component_Instance.
Qed.
